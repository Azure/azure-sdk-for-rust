trigger:
  branches:
    include:
      - main
      - release/*
      - hotfix/*
  paths:
    include:
      - sdk/eventhubs/azure_messaging_eventhubs_checkpointstore_blob/

pr:
  branches:
    include:
      - main
      - feature/*
  paths:
    include:
      - sdk/eventhubs/azure_messaging_eventhubs_checkpointstore_blob/

stages:
  - template: /eng/pipelines/templates/stages/1es-redirect.yml
    parameters:
      stages:
        - stage: Build
          displayName: 'Build and Test'
          jobs:
            - template: /eng/pipelines/templates/jobs/cargo.yml
              parameters:
                ServiceDirectory: eventhubs
                Package: azure_messaging_eventhubs_checkpointstore_blob
                JobName: 'azure_messaging_eventhubs_checkpointstore_blob'
                JobDisplayName: 'Azure EventHubs Checkpoint Store (Blob)'
                TestCommand: 'cargo test --all-features --package azure_messaging_eventhubs_checkpointstore_blob'
                BuildCommand: 'cargo build --all-features --package azure_messaging_eventhubs_checkpointstore_blob'
                Matrix:
                  Linux_Stable:
                    OSVmImage: 'ubuntu-20.04'
                    RustVersion: 'stable'
                  Linux_Beta:
                    OSVmImage: 'ubuntu-20.04'
                    RustVersion: 'beta'
                  Windows_Stable:
                    OSVmImage: 'windows-2022'
                    RustVersion: 'stable'
                  MacOS_Stable:
                    OSVmImage: 'macOS-12'
                    RustVersion: 'stable'

        - stage: Lint
          displayName: 'Lint and Format Check'
          dependsOn: []
          jobs:
            - template: /eng/pipelines/templates/jobs/cargo.yml
              parameters:
                ServiceDirectory: eventhubs
                Package: azure_messaging_eventhubs_checkpointstore_blob
                JobName: 'lint_azure_messaging_eventhubs_checkpointstore_blob'
                JobDisplayName: 'Lint Azure EventHubs Checkpoint Store (Blob)'
                TestCommand: 'cargo clippy --all-features --package azure_messaging_eventhubs_checkpointstore_blob -- -D warnings'
                BuildCommand: 'cargo fmt --package azure_messaging_eventhubs_checkpointstore_blob -- --check'
                Matrix:
                  Linux_Stable:
                    OSVmImage: 'ubuntu-20.04'
                    RustVersion: 'stable'
