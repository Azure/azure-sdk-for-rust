steps:
  - template: /eng/common/pipelines/templates/steps/set-vcpkg-cache-vars.yml

  - script: vcpkg --version
    condition: >-
      and(
      succeeded(),
      eq(variables['Agent.OS'], 'Windows_NT')
      )
    displayName: vcpkg --version

  - pwsh: |
      vcpkg install
      Write-Host "##vso[task.setvariable variable=VCPKG_ROOT;]${env:VCPKG_INSTALLATION_ROOT}"
      Write-Host "##vso[task.setvariable variable=VCPKG_INSTALLED_ROOT;]$PWD\vcpkg_installed"
      Write-Host "##vso[task.setvariable variable=OPENSSL_DIR;]$PWD\vcpkg_installed\x64-windows"
    condition: >-
      and(
      succeeded(),
      eq(variables['Agent.OS'], 'Windows_NT')
      )
    displayName: vcpkg install
    workingDirectory: eng/
    env:
      VCPKG_BINARY_SOURCES: $(VCPKG_BINARY_SOURCES_SECRET)
      X_VCPKG_ASSET_SOURCES: $(X_VCPKG_ASSET_SOURCES_SECRET)
